<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nginx | leesei&#39;s notebook</title>

  <meta name="author" content="leesei">
  
  <meta name="description" content="Technical blog for the future me and other beings.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Nginx"/>
  <meta property="og:site_name" content="leesei&#39;s notebook"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">leesei&#39;s notebook</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">		
			<h1> Nginx</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
	

			

	<!-- content -->
	<div class="mypage">		
	    <p><a href="http://nginx.org/" target="_blank" rel="external">nginx news</a><br><a href="https://wiki.archlinux.org/index.php/Nginx" target="_blank" rel="external">nginx - ArchWiki</a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://nginx.org/en/docs/" target="_blank" rel="external">nginx documentation</a><br><a href="http://nginx.org/en/docs/beginners_guide.html" target="_blank" rel="external">Beginner’s Guide</a><br><a href="https://www.nginx.com/resources/admin-guide/" target="_blank" rel="external">NGINX and NGINX Plus Admin Guide | NGINX</a></p>
<p><a href="http://wiki.nginx.org/Main" target="_blank" rel="external">Nginx Community</a><br><a href="http://wiki.nginx.org/GettingStarted" target="_blank" rel="external">GettingStarted - Nginx Community</a><br><a href="http://wiki.nginx.org/Pitfalls" target="_blank" rel="external">Pitfalls - Nginx Community</a></p>
<p><a href="http://tengine.taobao.org/book/index.html" target="_blank" rel="external">Nginx开发从入门到精通 — Nginx开发从入门到精通</a><br><a href="http://blog.sina.com.cn/openresty" target="_blank" rel="external">agentzh_新浪博客</a><br><a href="http://openresty.org/download/agentzh-nginx-tutorials-en.html" target="_blank" rel="external">agentzh’s Nginx Tutorials</a> <a href="http://openresty.org/#eBooks" target="_blank" rel="external">download</a> <a href="https://github.com/openresty/nginx-tutorials" target="_blank" rel="external">source</a><br><a href="http://code.tutsplus.com/series/cnginx-guide--cms-792" target="_blank" rel="external">cNginx Guide - Tuts+ Code Tutorials</a><br><a href="https://datahunter.org/nginx" target="_blank" rel="external">nginx | 夢想家</a><br><a href="http://www.aosabook.org/en/nginx.html" target="_blank" rel="external">The Architecture of Open Source Applications (Volume 2): nginx</a></p>
<p><a href="https://github.com/agile6v/awesome-nginx" target="_blank" rel="external">agile6v/awesome-nginx: A curated list of awesome Nginx distributions、third modules、active developers and etc.</a></p>
<p><a href="https://www.digitalocean.com/community/tags/nginx?type=tutorials" target="_blank" rel="external">Nginx Tutorials | DigitalOcean</a></p>
<h2 id="Tips-and-Tricks"><a href="#Tips-and-Tricks" class="headerlink" title="Tips and Tricks"></a>Tips and Tricks</h2><p><a href="https://calomel.org/nginx.html" target="_blank" rel="external">Nginx Secure SSL Web Server @ Calomel.org</a><br><a href="https://www.nginx.com/blog/10-tips-for-10x-application-performance/" target="_blank" rel="external">10 Tips to Improve Application Performance | NGINX</a><br><a href="https://bjornjohansen.no/optimizing-https-nginx" target="_blank" rel="external">Optimizing HTTPS on Nginx</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04" target="_blank" rel="external">How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04 | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-16-04" target="_blank" rel="external">How To Set Up Nginx with HTTP/2 Support on Ubuntu 16.04 | DigitalOcean</a><br><a href="https://www.nginx.com/blog/mitigating-ddos-attacks-with-nginx-and-nginx-plus/" target="_blank" rel="external">DDos Mitigation - Using NGINX to Prevent DDoS Attacks | NGINX</a><br><a href="https://blog.codeship.com/tuning-nginx/" target="_blank" rel="external">Tuning NGINX - via @codeship | via @codeship</a></p>
<h2 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h2><p><a href="http://openresty.org/en/" target="_blank" rel="external">OpenResty - Official Site</a> Nginx + module bundles</p>
<p><a href="https://github.com/bungle/awesome-resty" target="_blank" rel="external">bungle/awesome-resty: A List of Quality OpenResty Libraries, and Resources.</a><br><a href="https://openresty.org/en/using-luarocks.html" target="_blank" rel="external">OpenResty - Using LuaRocks</a></p>
<p><a href="https://hub.docker.com/r/ficusio/openresty/" target="_blank" rel="external">ficusio/openresty/</a></p>
<p><a href="http://agentzh.org/#Presentations" target="_blank" rel="external">agentzh’s presentations</a></p>
<p><a href="https://openresty.org/download/agentzh-nginx-tutorials-en.html" target="_blank" rel="external">agentzh’s Nginx Tutorials (version 2015.03.19)</a><br><a href="https://www.gitbook.com/book/moonbingbing/openresty-best-practices/details" target="_blank" rel="external">OpenResty最佳实践 - GitBook</a><br><a href="https://www.gitbook.com/book/openresty/programming-openresty/details" target="_blank" rel="external">Programming OpenResty · GitBook</a><br><a href="http://chaos2.qiniudn.com/openresty/build/html/" target="_blank" rel="external">乱入 OpenResty 手册! — chaos2openResty 2.1.130619 documentation</a><br><a href="http://openmymind.net/An-Introduction-To-OpenResty-Nginx-Lua/" target="_blank" rel="external">An Introduction To OpenResty (nginx + lua) - Part 1</a><br><a href="http://openmymind.net/An-Introduction-To-OpenResty-Part-2/" target="_blank" rel="external">An Introduction To OpenResty - Part 2 - Concepts</a><br><a href="http://openmymind.net/An-Introduction-To-OpenResty-Part-3/" target="_blank" rel="external">An Introduction To OpenResty - Part 3</a></p>
<p><a href="http://leafo.net/lapis/" target="_blank" rel="external">Lapis - A web framework for Lua or MoonScript powered by OpenResty</a></p>
<h3 id="Presentations"><a href="#Presentations" class="headerlink" title="Presentations"></a>Presentations</h3><p><a href="http://agentzh.org/misc/slides/qcon-beijing-2015/" target="_blank" rel="external">Application of Lua in Nginx</a></p>
<p><a href="http://blog-zq-org.qiniucdn.com/pyblosxom/2012/03/" target="_blank" rel="external">由Lua 粘合的Nginx生态环境 – agentzh tech-club.org 演讲听录 @ 2012-03-06 01:13 - Zoom.Quiet’s PyBlosxom blogging</a> <a href="http://agentzh.org/misc/slides/ngx-openresty-ecosystem/#8" target="_blank" rel="external">slides</a></p>
<p><a href="https://github.com/openresty/ngx_openresty" target="_blank" rel="external">openresty/ngx_openresty: Turning Nginx into a Full-Fledged Scriptable Web Platform</a><br><a href="https://github.com/openresty/lua-nginx-module" target="_blank" rel="external">openresty/lua-nginx-module - C</a><br><a href="https://github.com/openresty/lua-resty-core" target="_blank" rel="external">openresty/lua-resty-core: New FFI-based API for lua-nginx-module</a><br><a href="https://github.com/openresty/lua-resty-upload" target="_blank" rel="external">openresty/lua-resty-upload: Streaming reader and parser for http file uploading based on ngx_lua cosocket</a></p>
<p><a href="https://github.com/auth0/nginx-jwt" target="_blank" rel="external">auth0/nginx-jwt: Lua script for Nginx that performs reverse proxy auth using JWT’s</a></p>
<p><a href="https://github.com/grimen/nginx-sandbox" target="_blank" rel="external">grimen/nginx-sandbox: Nginx/OpenResty sandbox/playground - for experiments with building Nginx apps using Lua.</a></p>
<h2 id="Tengine"><a href="#Tengine" class="headerlink" title="Tengine"></a>Tengine</h2><p><a href="http://tengine.taobao.org/index.html" target="_blank" rel="external">The Tengine Web Server</a> Taobao’s fork<br><a href="https://liuzhichao.com/2016/tengine-http2.html#more" target="_blank" rel="external">在新版Tengine中开启HTTP/2协议支持 | 柳志超博客</a><br><a href="https://github.com/openresty/openresty/issues/54" target="_blank" rel="external">Difference between openresty and tengine · Issue #54 · openresty/openresty</a></p>
<h2 id="Amplify"><a href="#Amplify" class="headerlink" title="Amplify"></a>Amplify</h2><p><a href="https://github.com/nginxinc/nginx-amplify-doc/" target="_blank" rel="external">nginxinc/nginx-amplify-doc: Public documentation for Amplify</a></p>
<h2 id="vs-Apache"><a href="#vs-Apache" class="headerlink" title="vs Apache"></a>vs Apache</h2><p><a href="https://www.nginx.com/blog/nginx-vs-apache-our-view/" target="_blank" rel="external">NGINX vs. Apache: Our View of a Decade-Old Question</a><br><a href="https://michael.lustfield.net/nginx/nginx-vs-apache" target="_blank" rel="external">Nginx vs. Apache - Michael Lustfield</a><br><a href="https://www.digitalocean.com/community/tutorials/apache-vs-nginx-practical-considerations" target="_blank" rel="external">Apache vs Nginx: Practical Considerations | DigitalOcean</a><br><a href="https://www.upguard.com/articles/apache-vs-nginx" target="_blank" rel="external">Apache vs Nginx</a></p>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><blockquote>
<p><a href="https://github.com/h5bp/server-configs-nginx" target="_blank" rel="external">https://github.com/h5bp/server-configs-nginx</a><br><a href="https://github.com/Umkus/nginx-boilerplate" target="_blank" rel="external">https://github.com/Umkus/nginx-boilerplate</a><br><a href="https://github.com/perusio/nginx_ensite" target="_blank" rel="external">https://github.com/perusio/nginx_ensite</a></p>
</blockquote>
<p><a href="http://wiki.nginx.org/Configuration" target="_blank" rel="external">Configuration - Nginx Community</a></p>
<p><a href="http://nginx.org/en/docs/ngx_core_module.html" target="_blank" rel="external">Core functionality</a><br><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html" target="_blank" rel="external">Module ngx_http_core_module</a></p>
<p><a href="https://www.nginx.com/resources/admin-guide/serving-static-content/" target="_blank" rel="external">Serving Static Content | NGINX</a></p>
<p><a href="http://blog.martinfjordvald.com/2010/07/nginx-primer/" target="_blank" rel="external">Nginx Configuration Primer</a><br><a href="https://blog.martinfjordvald.com/2011/02/nginx-primer-2-from-apache-to-nginx/" target="_blank" rel="external">Nginx Primer 2: From Apache to Nginx</a><br><a href="http://nginxlibrary.com/" target="_blank" rel="external">Nginx Library</a><br><a href="https://blog.martinfjordvald.com/2013/06/debugging-nginx-errors/" target="_blank" rel="external">Debugging Nginx Errors</a><br><a href="https://blog.martinfjordvald.com/2012/08/understanding-the-nginx-configuration-inheritance-model/" target="_blank" rel="external">Understanding the Nginx Configuration Inheritance Model</a><br><a href="https://www.linode.com/docs/websites/nginx/how-to-configure-nginx/" target="_blank" rel="external">How to Configure nginx</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/understanding-nginx-server-and-location-block-selection-algorithms" target="_blank" rel="external">Understanding Nginx Server and Location Block Selection Algorithms | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04" target="_blank" rel="external">How To Set Up Nginx Server Blocks (Virtual Hosts) on Ubuntu 16.04 | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/understanding-the-nginx-configuration-file-structure-and-configuration-contexts" target="_blank" rel="external">Understanding the Nginx Configuration File Structure and Configuration Contexts | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-optimize-nginx-configuration" target="_blank" rel="external">How To Optimize Nginx Configuration | DigitalOcean</a></p>
<p>Main config filer (<code>nginx.conf</code>) sits in the Nginx config folder (e.g. <code>/etc/nginx</code>).  </p>
<blockquote>
<p>this config distro specific<br>There are <code>sites-available/</code> and <code>sites-enabled/</code>, default setting file includes <code>sites-enabled/*</code>.<br>Server files are usually put in <code>sites-available/</code> and symlinked to <code>sites-enabled/</code>.</p>
</blockquote>
<p>Options are called <em>directives</em>. They can live inside blocks (contexts) which define the scope they apply. Contexts are hierarchical: <code>main</code>, (<code>http</code>, <code>mail</code>, <code>stream</code>), <code>server</code>, <code>location</code>.</p>
<p>An array directive (e.g.: <code>fastcgi_param</code>) is basically any directive that can be used more than once in a single context. Each subsequent declaration (in the same scope) will append the new information to what Nginx knows from the previous declarations. Any declaration in sub-scope will clear the declarations in the parent scope.</p>
<h3 id="Snippets"><a href="#Snippets" class="headerlink" title="Snippets"></a>Snippets</h3><p><a href="https://github.com/timgws/handy-nginx-includes" target="_blank" rel="external">timgws/handy-nginx-includes: ‘best practice’ nginx configuration includes.</a><br><a href="https://github.com/lebinh/nginx-conf" target="_blank" rel="external">lebinh/nginx-conf: A collection of useful Nginx configuration snippets</a> !important<br><a href="https://github.com/danielrichman/nginx-config-snippets" target="_blank" rel="external">danielrichman/nginx-config-snippets: nginx config snippets: gzip, catchall, domain c14n, ssl, uwsgi, php, wordpress</a></p>
<h2 id="Internals"><a href="#Internals" class="headerlink" title="Internals"></a>Internals</h2><p><a href="https://www.nginx.com/resources/library/infographic-inside-nginx/" target="_blank" rel="external">Inside NGINX - NGINX</a><br><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="external">Inside NGINX: Designed for Performance &amp; Scalability</a><br><a href="https://www.nginx.com/blog/thread-pools-boost-performance-9x/" target="_blank" rel="external">Boosting NGINX Performance 9x with Thread Pools</a></p>
<h2 id="nginScript"><a href="#nginScript" class="headerlink" title="nginScript"></a>nginScript</h2><p><a href="https://www.nginx.com/blog/launching-nginscript-and-looking-ahead/" target="_blank" rel="external">Launching nginScript and Looking Ahead - NGINX</a><br><a href="https://www.nginx.com/blog/nginscript-why-our-own-javascript-implementation/" target="_blank" rel="external">nginScript - why create our own JavaScript implementation?</a><br><a href="https://www.nginx.com/blog/nginscript-new-powerful-way-configure-nginx/" target="_blank" rel="external">nginScript - A New and Powerful Way to Configure NGINX - NGINX</a><br><a href="https://www.nginx.com/resources/wiki/nginScript/" target="_blank" rel="external">nginScript Documentation | NGINX</a></p>
<h2 id="System-service"><a href="#System-service" class="headerlink" title="System service"></a>System service</h2><h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h3><blockquote>
<p><a href="https://github.com/JasonGiedymin/nginx-init-ubuntu" target="_blank" rel="external">https://github.com/JasonGiedymin/nginx-init-ubuntu</a><br><a href="https://github.com/hulihanapplications/nginx-init-debian" target="_blank" rel="external">https://github.com/hulihanapplications/nginx-init-debian</a></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">$ sudo service nginx </div><div class="line">configtest    force-reload  reload        restart       start         status        stop</div></pre></td></tr></table></figure>
<h3 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h3><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">sudo systemctl <span class="built_in">enable</span> nginx.service</div><div class="line">sudo systemctl start nginx.service</div></pre></td></tr></table></figure>
<h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><p><a href="http://wiki.nginx.org/3rdPartyModules" target="_blank" rel="external">3rdPartyModules - Nginx Community</a><br><a href="http://www.evanmiller.org/nginx-modules-guide.html" target="_blank" rel="external">Emiller’s Guide to Nginx Module Development</a></p>
<table>
<thead>
<tr>
<th>Module</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Auth Digest</td>
<td><a href="https://github.com/samizdatco/nginx-http-auth-digest" target="_blank" rel="external">https://github.com/samizdatco/nginx-http-auth-digest</a></td>
</tr>
<tr>
<td>nginx-jwt</td>
<td><a href="https://github.com/auth0/nginx-jwt" target="_blank" rel="external">https://github.com/auth0/nginx-jwt</a></td>
</tr>
<tr>
<td>Echo</td>
<td><a href="https://github.com/agentzh/echo-nginx-module" target="_blank" rel="external">https://github.com/agentzh/echo-nginx-module</a></td>
</tr>
<tr>
<td>Fancy Indexes</td>
<td><a href="https://github.com/aperezdc/ngx-fancyindex" target="_blank" rel="external">https://github.com/aperezdc/ngx-fancyindex</a></td>
</tr>
<tr>
<td>Log If</td>
<td><a href="https://github.com/cfsego/ngx_log_if/" target="_blank" rel="external">https://github.com/cfsego/ngx_log_if/</a></td>
</tr>
<tr>
<td>PageSpeeed</td>
<td><a href="http://ngxpagespeed.com/ngx_pagespeed_example/" target="_blank" rel="external">http://ngxpagespeed.com/ngx_pagespeed_example/</a></td>
</tr>
<tr>
<td>MP4 streaming</td>
<td><a href="http://nginx.org/en/docs/http/ngx_http_mp4_module.html" target="_blank" rel="external">http://nginx.org/en/docs/http/ngx_http_mp4_module.html</a></td>
</tr>
</tbody>
</table>
<hr>
<h1 id="Use-Cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases</h1><h2 id="Static-file-serving"><a href="#Static-file-serving" class="headerlink" title="Static file serving"></a>Static file serving</h2><figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">user</span> http;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>   <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  domain.com www.domain.com;</div><div class="line">    <span class="attribute">access_log</span>   /var/log/nginx/static_server.log combined;</div><div class="line">    <span class="attribute">root</span>   /home/www;</div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">index</span>  index.php index.html index.htm;</div><div class="line">        <span class="comment"># Directory listing</span></div><div class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment"># Password protect a directory</span></div><div class="line">    <span class="attribute">location</span><span class="regexp"> ^~</span> /secret_folder/ &#123;</div><div class="line">        <span class="attribute">auth_basic</span>            <span class="string">"Restricted Area"</span>;</div><div class="line">        <span class="comment"># relative to this config file</span></div><div class="line">        <span class="comment"># using Apache's `htpasswd -b htpasswd NewUser NewPassword` or</span></div><div class="line">        <span class="comment"># http://www.tools.dynamicdrive.com/password/</span></div><div class="line">        <span class="attribute">auth_basic_user_file</span>  conf/htpasswd;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Setup group and ownership of <code>www</code> folder</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">sudo -v</div><div class="line">mkdir /home/www</div><div class="line">usermod <span class="_">-a</span> -G http <span class="variable">$&#123;USER&#125;</span></div><div class="line">chown -R http:http /home/www</div><div class="line">chmod -R g+w /home/www</div></pre></td></tr></table></figure>
<p><a href="https://serversforhackers.com/video/linux-acls" target="_blank" rel="external">Linux ACLs - Servers for Hackers</a><br><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">mkdir /home/www</div><div class="line">getfacl /home/www</div><div class="line">setfacl -R -m u:<span class="variable">$&#123;USER&#125;</span>:rwx /var/www</div></pre></td></tr></table></figure></p>
<h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p><a href="https://www.wikiwand.com/en/Load_balancing_%28computing%29#/Server-side_Load_Balancers" target="_blank" rel="external">Load balancing (computing) - Wikiwand</a><br><a href="http://nginx.org/en/docs/http/load_balancing.html" target="_blank" rel="external">Using nginx as HTTP load balancer</a><br><a href="https://www.nginx.com/resources/admin-guide/load-balancer/" target="_blank" rel="external">NGINX Load Balancing - HTTP and TCP Load Balancer</a><br><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="external">Module ngx_http_proxy_module</a><br><a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="external">Module ngx_http_upstream_module</a></p>
<p><a href="https://www.linode.com/docs/uptime/loadbalancing/use-nginx-as-a-front-end-proxy-and-software-load-balancer" target="_blank" rel="external">Use Nginx as a Front-end Proxy and Software Load Balancer</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-configure-nginx-as-a-web-server-and-reverse-proxy-for-apache-on-one-ubuntu-14-04-droplet" target="_blank" rel="external">How To Configure Nginx as a Web Server and Reverse Proxy for Apache on One Ubuntu 14.04 Droplet | DigitalOcean</a></p>
<h3 id="SSL-Termination"><a href="#SSL-Termination" class="headerlink" title="SSL Termination"></a>SSL Termination</h3><p><a href="https://www.nginx.com/resources/admin-guide/nginx-ssl-termination/" target="_blank" rel="external">NGINX SSL Termination | NGINX</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-configure-nginx-with-ssl-as-a-reverse-proxy-for-jenkins" target="_blank" rel="external">How To Configure Nginx with SSL as a Reverse Proxy for Jenkins | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-load-balancing-with-ssl-termination" target="_blank" rel="external">How To Set Up Nginx Load Balancing with SSL Termination | DigitalOcean</a></p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p><a href="https://hub.docker.com/r/jwilder/nginx-proxy/" target="_blank" rel="external">jwilder/nginx-proxy</a><br><a href="http://jasonwilder.com/blog/2014/03/25/automated-nginx-reverse-proxy-for-docker/" target="_blank" rel="external">Automated Nginx Reverse Proxy for Docker ·</a></p>
<p><a href="https://github.com/jasonwyatt/docker-nginx-loadbalancer" target="_blank" rel="external">jasonwyatt/docker-nginx-loadbalancer: Nginx Load Balancer for Docker. It reads links to containers which expose and generates a suitable Nginx config file at startup.</a></p>
<p><a href="https://www.weave.works/guides/using-nginx-as-a-reverse-proxyload-balancer-with-weave-and-docker/" target="_blank" rel="external">Using Nginx as a reverse proxy/load balancer with Weave and Docker - Weaveworks</a></p>
<h3 id="CGI"><a href="#CGI" class="headerlink" title="CGI"></a>CGI</h3><p><a href="https://www.digitalocean.com/community/tutorials/understanding-and-implementing-fastcgi-proxying-in-nginx" target="_blank" rel="external">Understanding and Implementing FastCGI Proxying in Nginx | DigitalOcean</a></p>
<h3 id="load-balancing"><a href="#load-balancing" class="headerlink" title="load balancing"></a>load balancing</h3><p><a href="http://nginx.org/en/docs/http/load_balancing.html" target="_blank" rel="external">Using nginx as HTTP load balancer</a><br><a href="https://www.nginx.com/resources/admin-guide/load-balancer/" target="_blank" rel="external">NGINX Load Balancing - HTTP and TCP Load Balancer</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-load-balancing" target="_blank" rel="external">How To Set Up Nginx Load Balancing | DigitalOcean</a><br><a href="https://m.alphasights.com/using-nginx-on-heroku-to-serve-single-page-apps-and-avoid-cors-5d013b171a45" target="_blank" rel="external">Using NGINX on Heroku to Serve Single Page Apps and Avoid CORS — AlphaSights Engineering</a></p>
<p>Add this to <code>hosts</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">127.0.0.1   mynodeapp.dev</div></pre></td></tr></table></figure>
<blockquote>
<p>Uses <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="external">upstream module</a> for abstraction and load balancing</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="comment"># node.conf</span></div><div class="line"></div><div class="line"><span class="comment"># using node app as an example backend</span></div><div class="line"><span class="attribute">upstream</span> node &#123;</div><div class="line">    <span class="attribute">server</span> http://127.0.0.1:3000</div><div class="line">    server unix:/tmp/mynodeapp.socket;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span> mynodeapp.dev</div><div class="line">    location / &#123;</div><div class="line">            <span class="attribute">proxy_pass</span> node;</div><div class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Reverse-proxy-api-github-com"><a href="#Reverse-proxy-api-github-com" class="headerlink" title="Reverse proxy api.github.com"></a>Reverse proxy <code>api.github.com</code></h3><p>Add this to <code>hosts</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">127.0.0.1   api.github.localhost</div></pre></td></tr></table></figure>
<p>Add this to <code>/etc/nginx/sites-enabled/api.github</code>:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span> api.github.localhost;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">proxy_set_header</span> Host api.github.com;</div><div class="line">        <span class="attribute">proxy_pass</span> https://api.github.com/;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="attribute">access_log</span>      /var/log/nginx/github_access.log combined;</div><div class="line">    <span class="attribute">error_log</span>       /var/log/nginx/github_error.log <span class="literal">error</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h2><p>Redirect to https<br><figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">server_name</span> _;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^</span> https://example.com<span class="variable">$request_uri</span> <span class="literal">permanent</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-redirect-www-to-non-www-with-nginx-on-ubuntu-14-04" target="_blank" rel="external">How To Redirect www to Non-www with Nginx on Ubuntu 14.04 | DigitalOcean</a></p>
<h2 id="HTTP2"><a href="#HTTP2" class="headerlink" title="HTTP2"></a>HTTP2</h2><p><a href="https://serversforhackers.com/video/http-20-with-nginx" target="_blank" rel="external">HTTP 2.0 With Nginx - Servers for Hackers</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-16-04" target="_blank" rel="external">How To Set Up Nginx with HTTP/2 Support on Ubuntu 16.04 | DigitalOcean</a></p>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p><a href="http://enable-cors.org/index.html" target="_blank" rel="external">enable cross-origin resource sharing</a><br><a href="https://gist.github.com/Stanback/7145487" target="_blank" rel="external">Example Nginx configuration for adding cross-origin resource sharing (CORS) support to reverse proxied APIs</a><br><a href="https://gist.github.com/michiel/1064640" target="_blank" rel="external">Wide-open CORS config for nginx</a></p>
<h2 id="Node-Nginx"><a href="#Node-Nginx" class="headerlink" title="Node/Nginx"></a>Node/Nginx</h2><blockquote>
<p>these settings are not tested</p>
</blockquote>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-14-04" target="_blank" rel="external">How To Set Up a Node.js Application for Production on Ubuntu 14.04 | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-deploy-node-js-applications-using-systemd-and-nginx" target="_blank" rel="external">How To Deploy Node.js Applications Using Systemd and Nginx | DigitalOcean</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-host-multiple-node-js-applications-on-a-single-vps-with-nginx-forever-and-crontab" target="_blank" rel="external">How To Host Multiple Node.js Applications On a Single VPS with nginx, forever, and crontab | DigitalOcean</a><br><a href="https://github.com/rubenv/node-systemd" target="_blank" rel="external">rubenv/node-systemd: Support for running node.js as a socket-activated service under systemd</a><br><a href="https://rocketeer.be/articles/deploying-node-js-with-systemd/" target="_blank" rel="external">Deploying Node.js with systemd · Ruben Vermeersch (rubenv)</a></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="comment"># node.conf</span></div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span> localhost</div><div class="line">    location / &#123;</div><div class="line">        <span class="attribute">root</span>   /home/www;</div><div class="line">    &#125;</div><div class="line">    <span class="attribute">location</span> /api/ &#123;</div><div class="line">        <span class="comment"># forward API endpoint to internal API server</span></div><div class="line">        <span class="attribute">proxy_pass</span> http://192.168.1.10:3000;</div><div class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Nginx-status-page"><a href="#Nginx-status-page" class="headerlink" title="Nginx status page"></a>Nginx status page</h2><figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">location</span> /nginx_status &#123;</div><div class="line">    <span class="comment"># Turn on nginx stats</span></div><div class="line">    <span class="attribute">stub_status</span> <span class="literal">on</span>;</div><div class="line">    <span class="comment"># I do not need logs for stats</span></div><div class="line">    <span class="attribute">access_log</span>   <span class="literal">off</span>;</div><div class="line">    <span class="comment"># Security: Only allow access from 192.168.1.100 IP #</span></div><div class="line">    <span class="attribute">allow</span> <span class="number">192.168.1.100</span>;</div><div class="line">    <span class="comment"># Send rest of the world to /dev/null #</span></div><div class="line">    <span class="attribute">deny</span> all;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/tmux/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/heroku/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
  	 <div id="disqus_thread">
     <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  	 </div>
  
</section>

	
	</div> <!-- col-md-9/col-md-12 -->
	
	
		<div class="col-md-3"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2014-12-11 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/web/">web<span>53</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/notes/">notes<span>21</span></a></li> <li><a href="/tags/nginx/">nginx<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#References"><span class="toc-article-text">References</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Tips-and-Tricks"><span class="toc-article-text">Tips and Tricks</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#OpenResty"><span class="toc-article-text">OpenResty</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Presentations"><span class="toc-article-text">Presentations</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Tengine"><span class="toc-article-text">Tengine</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Amplify"><span class="toc-article-text">Amplify</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#vs-Apache"><span class="toc-article-text">vs Apache</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Configuration"><span class="toc-article-text">Configuration</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Snippets"><span class="toc-article-text">Snippets</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Internals"><span class="toc-article-text">Internals</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#nginScript"><span class="toc-article-text">nginScript</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#System-service"><span class="toc-article-text">System service</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Debian-Ubuntu"><span class="toc-article-text">Debian/Ubuntu</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#systemd"><span class="toc-article-text">systemd</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Modules"><span class="toc-article-text">Modules</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Use-Cases"><span class="toc-article-text">Use Cases</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Static-file-serving"><span class="toc-article-text">Static file serving</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Proxy"><span class="toc-article-text">Proxy</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#SSL-Termination"><span class="toc-article-text">SSL Termination</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Docker"><span class="toc-article-text">Docker</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CGI"><span class="toc-article-text">CGI</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#load-balancing"><span class="toc-article-text">load balancing</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Reverse-proxy-api-github-com"><span class="toc-article-text">Reverse proxy api.github.com</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Redirect"><span class="toc-article-text">Redirect</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#HTTP2"><span class="toc-article-text">HTTP2</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#CORS"><span class="toc-article-text">CORS</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Node-Nginx"><span class="toc-article-text">Node/Nginx</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Nginx-status-page"><span class="toc-article-text">Nginx status page</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2017 leesei
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a> (customized by <a href="https://github.com/leesei/hexo-theme-freemind/tree/leesei.github.io">leesei</a>).
</p>
 </footer>
</div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>


<script type="text/javascript">
var disqus_shortname = 'leesei';
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
   </html>
